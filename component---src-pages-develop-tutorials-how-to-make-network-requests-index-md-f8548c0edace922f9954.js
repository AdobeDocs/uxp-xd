(window.webpackJsonp=window.webpackJsonp||[]).push([[177],{oinF:function(e,t,n){"use strict";n.r(t),n.d(t,"_frontmatter",(function(){return r})),n.d(t,"default",(function(){return s}));var a=n("wx14"),l=n("zLVn"),o=(n("q1tI"),n("7ljp")),i=n("ndZU"),r=(n("qKvR"),{}),m={_frontmatter:r},c=i.a;function s(e){var t=e.components,n=Object(l.a)(e,["components"]);return Object(o.mdx)(c,Object(a.a)({},m,n,{components:t,mdxType:"MDXLayout"}),Object(o.mdx)("h1",{id:"how-to-make-network-requests"},"How to make network requests"),Object(o.mdx)("p",null,"This sample app will show you how to load an image in an XD object (Rectangle or Artboard) by making network requests using ",Object(o.mdx)("inlineCode",{parentName:"p"},"XHR")," and ",Object(o.mdx)("inlineCode",{parentName:"p"},"fetch"),"."),Object(o.mdx)("h2",{id:"prerequisites"},"Prerequisites"),Object(o.mdx)("ul",null,Object(o.mdx)("li",{parentName:"ul"},"Basic knowledge of HTML, CSS, and JavaScript"),Object(o.mdx)("li",{parentName:"ul"},"Basic knowledge of ",Object(o.mdx)("inlineCode",{parentName:"li"},"XMLHttpRequest")," and ",Object(o.mdx)("inlineCode",{parentName:"li"},"fetch")),Object(o.mdx)("li",{parentName:"ul"},Object(o.mdx)("a",Object(a.a)({parentName:"li"},{href:"/uxp-xd/develop/tutorials/quick-start/"}),"Quick Start Tutorial")),Object(o.mdx)("li",{parentName:"ul"},Object(o.mdx)("a",Object(a.a)({parentName:"li"},{href:"/uxp-xd/develop/tutorials/debugging/"}),"Debugging Tutorial"))),Object(o.mdx)("h2",{id:"development-steps"},"Development Steps"),Object(o.mdx)("blockquote",null,Object(o.mdx)("p",{parentName:"blockquote"},Object(o.mdx)("strong",{parentName:"p"},"Info"),"\nComplete code for this plugin can be found ",Object(o.mdx)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/AdobeXD/Plugin-Samples/tree/master/how-to-make-network-requests"}),"on GitHub"),".")),Object(o.mdx)("h3",{id:"1-create-plugin-scaffold"},"1. Create plugin scaffold"),Object(o.mdx)("p",null,"First, edit the manifest file for the plugin you created in our ",Object(o.mdx)("a",Object(a.a)({parentName:"p"},{href:"/uxp-xd/develop/tutorials/quick-start"}),"Quick Start Tutorial"),"."),Object(o.mdx)("p",null,"Replace the ",Object(o.mdx)("inlineCode",{parentName:"p"},"uiEntryPoints")," field of the manifest with the following:"),Object(o.mdx)("pre",null,Object(o.mdx)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'"uiEntryPoints": [\n    {\n        "type": "menu",\n        "label": "How to make network requests",\n        "commandId": "applyImage"\n    }\n]\n')),Object(o.mdx)("p",null,"If you're curious about what each entry means, ",Object(o.mdx)("a",Object(a.a)({parentName:"p"},{href:"/uxp-xd/develop/plugin-development/plugin-structure/manifest/"}),"see the manifest documentation"),", where you can also learn about all manifest requirements for a plugin to be published in the XD Plugin Manager."),Object(o.mdx)("p",null,"Then, update your ",Object(o.mdx)("inlineCode",{parentName:"p"},"main.js")," file, mapping the manifest's ",Object(o.mdx)("inlineCode",{parentName:"p"},"commandId")," to a handler function."),Object(o.mdx)("p",null,"Replace the content of your ",Object(o.mdx)("inlineCode",{parentName:"p"},"main.js")," file with the following code:"),Object(o.mdx)("pre",null,Object(o.mdx)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"function applyImage(selection) {\n  // The body of this function is added later\n}\n\nmodule.exports = {\n  commands: {\n    applyImage,\n  },\n};\n")),Object(o.mdx)("p",null,"The remaining steps in this tutorial describe additional edits to the ",Object(o.mdx)("inlineCode",{parentName:"p"},"main.js")," file."),Object(o.mdx)("h3",{id:"2-require-in-xd-api-dependencies"},"2. Require in XD API dependencies"),Object(o.mdx)("p",null,"For this tutorial, we just need access to one XD scenegraph class."),Object(o.mdx)("p",null,"Add the following lines to the top of your ",Object(o.mdx)("inlineCode",{parentName:"p"},"main.js")," file:"),Object(o.mdx)("pre",null,Object(o.mdx)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),'// Add this to the top of your main.js file\nconst { ImageFill } = require("scenegraph");\n')),Object(o.mdx)("p",null,"Now the ",Object(o.mdx)("inlineCode",{parentName:"p"},"ImageFill")," class is imported and ready to be used."),Object(o.mdx)("h3",{id:"3-write-a-helper-function-to-make-xhr-requests"},"3. Write a helper function to make XHR requests"),Object(o.mdx)("p",null,"Our XHR helper ",Object(o.mdx)("inlineCode",{parentName:"p"},"xhrBinary")," will make an HTTP GET request to any URL it is passed, and a return a Promise with an ",Object(o.mdx)("inlineCode",{parentName:"p"},"arraybuffer"),"."),Object(o.mdx)("pre",null,Object(o.mdx)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),'function xhrBinary(url) {\n  // [1]\n  return new Promise((resolve, reject) => {\n    // [2]\n    const req = new XMLHttpRequest(); // [3]\n    req.onload = () => {\n      if (req.status === 200) {\n        try {\n          const arr = new Uint8Array(req.response); // [4]\n          resolve(arr); // [5]\n        } catch (err) {\n          reject(`Couldnt parse response. ${err.message}, ${req.response}`);\n        }\n      } else {\n        reject(`Request had an error: ${req.status}`);\n      }\n    };\n    req.onerror = reject;\n    req.onabort = reject;\n    req.open("GET", url, true);\n    req.responseType = "arraybuffer"; // [6]\n    req.send();\n  });\n}\n')),Object(o.mdx)("ol",null,Object(o.mdx)("li",{parentName:"ol"},Object(o.mdx)("inlineCode",{parentName:"li"},"xhrBinary")," function takes a url as a parameter"),Object(o.mdx)("li",{parentName:"ol"},"The function returns a Promise"),Object(o.mdx)("li",{parentName:"ol"},"The function uses ",Object(o.mdx)("inlineCode",{parentName:"li"},"XMLHttpRequest")," to make network requests"),Object(o.mdx)("li",{parentName:"ol"},"Once the correct response comes back, the function uses ",Object(o.mdx)("inlineCode",{parentName:"li"},"Unit8Array")," method to convert the response to an ",Object(o.mdx)("inlineCode",{parentName:"li"},"arraybuffer")),Object(o.mdx)("li",{parentName:"ol"},"After the conversion, the promise is resolved"),Object(o.mdx)("li",{parentName:"ol"},"Make sure the set the ",Object(o.mdx)("inlineCode",{parentName:"li"},"responseType")," as ",Object(o.mdx)("inlineCode",{parentName:"li"},"arraybuffer"))),Object(o.mdx)("h3",{id:"4-write-a-helper-to-apply-imagefill"},"4. Write a helper to apply ",Object(o.mdx)("inlineCode",{parentName:"h3"},"ImageFill")),Object(o.mdx)("p",null,"This helper function will create an ",Object(o.mdx)("inlineCode",{parentName:"p"},"ImageFill")," instance that can be applied to a user-selected XD scengraph object:"),Object(o.mdx)("pre",null,Object(o.mdx)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"function applyImagefill(selection, file) {\n  // [1]\n  const imageFill = new ImageFill(file); // [2]\n  selection.items[0].fill = imageFill; // [3]\n}\n")),Object(o.mdx)("ol",null,Object(o.mdx)("li",{parentName:"ol"},"The function accepts the ",Object(o.mdx)("inlineCode",{parentName:"li"},"selection")," and a ",Object(o.mdx)("inlineCode",{parentName:"li"},"file")," as parameters"),Object(o.mdx)("li",{parentName:"ol"},"Use the ",Object(o.mdx)("inlineCode",{parentName:"li"},"ImageFill")," class to create the fill"),Object(o.mdx)("li",{parentName:"ol"},"Apply the image to the user-selected XD object")),Object(o.mdx)("p",null,"We'll use this function in the next step."),Object(o.mdx)("h3",{id:"5-write-a-helper-function-to-download-the-image"},"5. Write a helper function to download the image"),Object(o.mdx)("p",null,"Ok, you've just made three helper functions. Now we're going to tie them all together!"),Object(o.mdx)("p",null,"Note the use of the ",Object(o.mdx)("inlineCode",{parentName:"p"},"async")," keyword at the beginning of the function."),Object(o.mdx)("pre",null,Object(o.mdx)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),'async function downloadImage(selection, jsonResponse) {\n  // [1]\n  try {\n    const photoUrl = jsonResponse.message; // [2]\n    const photoObj = await xhrBinary(photoUrl); // [3]\n    const tempFolder = await fs.getTemporaryFolder(); // [4]\n    const tempFile = await tempFolder.createFile("tmp", { overwrite: true }); // [5]\n    await tempFile.write(photoObj, { format: uxp.formats.binary }); // [6]\n    applyImagefill(selection, tempFile); // [7]\n  } catch (err) {\n    console.log("error");\n    console.log(err.message);\n  }\n}\n')),Object(o.mdx)("ol",null,Object(o.mdx)("li",{parentName:"ol"},"This helper function accepts the ",Object(o.mdx)("inlineCode",{parentName:"li"},"selection")," and a JSON response object as parameters"),Object(o.mdx)("li",{parentName:"ol"},"Gets the URL from the JSON response"),Object(o.mdx)("li",{parentName:"ol"},"Uses our async ",Object(o.mdx)("inlineCode",{parentName:"li"},"xhrBinary")," function to get an ",Object(o.mdx)("inlineCode",{parentName:"li"},"arraybuffer")),Object(o.mdx)("li",{parentName:"ol"},"Uses the ",Object(o.mdx)("inlineCode",{parentName:"li"},"fs")," module and its ",Object(o.mdx)("inlineCode",{parentName:"li"},"getTemporaryFolder")," method to create a temp folder"),Object(o.mdx)("li",{parentName:"ol"},"Uses the ",Object(o.mdx)("inlineCode",{parentName:"li"},"createFile")," method to create a temp file"),Object(o.mdx)("li",{parentName:"ol"},"Uses the ",Object(o.mdx)("inlineCode",{parentName:"li"},"write")," method to write the binary file to store"),Object(o.mdx)("li",{parentName:"ol"},"Uses ",Object(o.mdx)("inlineCode",{parentName:"li"},"applyImagefill")," to place the image into a user-selected XD object")),Object(o.mdx)("h3",{id:"6-write-the-main-handler-function"},"6. Write the main handler function"),Object(o.mdx)("p",null,"This is the function that will be called with the user runs our plugin command."),Object(o.mdx)("pre",null,Object(o.mdx)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),'function applyImage(selection) {\n  if (selection.items.length) {\n    // [1]\n    const url = "https://dog.ceo/api/breeds/image/random"; // [2]\n    return fetch(url) // [3]\n      .then(function (response) {\n        return response.json(); // [4]\n      })\n      .then(function (jsonResponse) {\n        return downloadImage(selection, jsonResponse); // [5]\n      });\n  } else {\n    console.log("Please select a shape to apply the downloaded image.");\n  }\n}\n')),Object(o.mdx)("ol",null,Object(o.mdx)("li",{parentName:"ol"},"Checks if user has selected at least one object"),Object(o.mdx)("li",{parentName:"ol"},"This is an example public URL to an image"),Object(o.mdx)("li",{parentName:"ol"},"Pass the URL to ",Object(o.mdx)("inlineCode",{parentName:"li"},"fetch")),Object(o.mdx)("li",{parentName:"ol"},"The first ",Object(o.mdx)("inlineCode",{parentName:"li"},".then")," block returns the response JSON object"),Object(o.mdx)("li",{parentName:"ol"},"The second ",Object(o.mdx)("inlineCode",{parentName:"li"},".then")," block passes the ",Object(o.mdx)("inlineCode",{parentName:"li"},"selection")," and our JSON reponse to our ",Object(o.mdx)("inlineCode",{parentName:"li"},"downloadImage")," function, ultimately placing it in the document")))}s.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-develop-tutorials-how-to-make-network-requests-index-md-f8548c0edace922f9954.js.map